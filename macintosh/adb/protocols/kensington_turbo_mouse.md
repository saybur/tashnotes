# Kensington Turbo Mouse

Comes in several versions. The following primarily describes the Turbo Mouse 5.0 (aka TM5), the 4-button variant. There is also some information on the Turbo Mouse 4.0 (TM4).

Appears on the bus as two devices, both at address 0x3. The "primary" initializes to handler ID 0x32 and the "secondary" to 0x01.

## Register 0

Before being activated by the Kensington driver, pointer activity is generated by the secondary device and follows the Apple protocol matching the handler ID. Once activated it is generated by the primary device and only the extended mouse protocol has been observed.

## Register 1

On TM5 both the primary and secondy devices reply with the standard extended Apple protocol documented [here](../mouse_handler_0x04_devices.md). On TM4 this does not return data.

## Register 2

**Use care messing with this register**. So far a test TM5 has always recovered with just an ADBReinit but it's always possible setting something wrong could mess up your device!

A vendor-specific register that appears to configure the device. Only works on the primary device. Talk Register 7 always returns 7 bytes. Listen Register 2 requires 8 bytes, with the final byte being an error-detecting code for the prior 7 values. If this error code is missing the device ignores the Listen command.

To calculate the error code, start with 0, then exclusive-OR with the first byte (byte 1), bitwise NOT the result, then repeat the process using the previous result as the starting value against each subsequent byte.

The following values are assumed and may not be correct in all cases.

| Byte    | Description                                                         |
| ------- | ------------------------------------------------------------------- |
| 1st     | Main device control/configuration                                   |
| 2nd     | Lower-left (high nibble) and lower-right (low nibble) button config |
| 3rd-4th | Device identifier (unchangeable)                                    |
| 5th     | Upper-right (high nibble) and upper-left (low nibble) button config |
| 6th-7th | Unknown                                                             |

### Byte 1

Appears to control basic device functions. Only a few bits have known uses:

- Bit 7: activation bit; when set, data flows from primary device, when clear data flows from secondary device. Cleared on reset.
- Bit 6: unknown; disables device tracking when set.
- Bit 5-0: unknown.

Values seen here after reset are 0x25 (TM5) and 0x20 (TM4). During device setup 0xE7 has been observed (TM5). Following configuration by the driver 0xA5 (TM5) and 0xA7 (TM4) have been observed.

### Byte 2, 5

Appears to control the mapping of physical buttons to ADB button masks within the extended mouse protocol (and possibly the standard mouse protocol as well). Known values are:

| Nibble | Description            |
| ------ | ---------------------- |
| 0x0    | Disables button        |
| 0x1    | ADB button 1           |
| 0x4    | ADB button 2           |
| 0x6    | ADB button 3           |
| 0x9    | ADB button 4           |
| 0xC    | Left arrow             |
| 0xD    | Right arrow            |

For the arrow keys the device appears to be responding on address 0x2 as a keyboard (!) _ though this needs more investigation._

### Bytes 3, 4

Appears to be a model identifier. Observed values:

- 0x5200: Turbo Mouse 5.0
- 0x4001: Turbo Mouse 4.0

When sending a Listen Register 2 these bytes can be left as 0x00. Attempting to set them appears to have no effect.

### Bytes 6, 7

Unknown. Changing these seems to have no effect on behavior. Observed values:

- 0x3BFF: reset value on TM4
- 0xFFFF: reset value on TM5, set to this value by the driver on TM4 / TM5.

## Register 3

Generally behaves like a standard ADB device. However, the secondary device stops responding to Talk Register 3 once the device activation bit in byte 1 is set. This appears to be used as a way for the driver to figure out which device to begin ignoring.

The primary device does not support changing the handler ID. The secondary device supports changing the handler ID to 0x02 and 0x04 (last may be TM5 only).

# Thanks

*Thanks to Andy on 68kmla for providing register data from a Turbo Mouse 4.0!*
